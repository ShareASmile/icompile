<!DOCTYPE html>
<html encoding="UTF-8" charset="UTF-8" dir="ltr" lang="en-US" xml:lang="en-US" language="English" itemscope="" itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">

<head>
<!-- ╔════════════════════════════════════════════════╗
     ║ favor latest IE with Chrome-Frame if possible. ║
     ╚════════════════════════════════════════════════╝ -->
  <meta http-equiv="X-UA-Compatible"                   content="IE=edge,chrome=1"                                      />
<!-- ╔════════════════════════════════════════════════════════════╗
     ║ normalize script/style engine with explicit character-set. ║
     ╚════════════════════════════════════════════════════════════╝ -->
  <meta charset="UTF-8"                                                                                                />
  <meta http-equiv="content-type"                      content="text/html;charset=UTF-8"                               />
  <meta http-equiv="Content-Script-Type"               content="text/javascript;charset=UTF-8"                         />
  <meta http-equiv="Content-Style-Type"                content="text/css;charset=UTF-8"                                />
<!-- ╔══════════════════════════════════════════════╗
     ║ bread and butter of mobile-friendly website. ║
     ╚══════════════════════════════════════════════╝ -->
  <meta name="viewport"                                content="width=device-width,initial-scale=1.0,shrink-to-fit=no,minimal-ui"                                           />
<!-- ╔════════════════════════════╗
     ║ poor's man's HTTP-Headers. ║
     ╚════════════════════════════╝ -->
  <meta http-equiv="Feature-Policy"                    content="fullscreen *; wake-lock *; vibrate *; geolocation *;"  />
  <meta http-equiv="Cache-Control"                     content="public,max-age=1800,max-stale,stale-while-revalidate=86400,stale-if-error=259200" rem="max-age=30minutes"   />
  <meta http-equiv="X-Content-Type-Options"            content="nosniff"                                               />
  <meta http-equiv="X-DNS-Prefetch-Control"            content="on"                                                    />
<!-- needs more work... 
  <meta http-equiv="Content-Security-Policy"           content="default-src 'none'; base-uri 'self'; block-all-mixed-content; connect-src 'self' icompile.eladkarako.com eladkarako.com eladkarako.github.io www.google.com www.google-analytics.com www.googletagmanager.com www.github.com gist.github.com gist.githubusercontent.com; font-src github.githubassets.com; form-action 'none; frame-ancestors 'self'; frame-src 'self' render.githubusercontent.com gist.github.com; img-src 'self' *.imgur.com data: *.githubusercontent.com; media-src 'none'; script-src 'self' github.githubassets.com; style-src 'unsafe-inline' github.githubassets.com; worker-src 'none'"                                                                                                         />
-->  
  <meta http-equiv="X-XSS-Protection"                  content="1; mode=block"                                         />
<!-- ╔════════════════════════════════════╗
     ║ disable browser annoying features. ║
     ╚════════════════════════════════════╝ -->
  <meta name="format-detection"                        content="telephone=no,date=no,address=no,email=no,url=no"       />
  <meta http-equiv="imagetoolbar"                      content="no"                                                    />
  <meta http-equiv="cleartype"                         content="on"                                                    />
  <meta http-equiv="Page-Enter"                        content="RevealTrans(Duration=0.0,Transition=0.0)"              />
  <meta http-equiv="Page-Exit"                         content="RevealTrans(Duration=0.0,Transition=0.0)"              />
  <!-----------------------------------------------------------------------do not modify line below here, an installed skype read it AS IS (you need to make the HTML is UTF-8 (no BOM) with Windown EOL). -->
  <meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE">
  <!--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- ╔══════════════════════════════════╗
     ║ compatible with viewport for IE. ║
     ╚══════════════════════════════════╝ -->
  <meta name="HandheldFriendly"                        content="True"              />
  <meta name="MSThemeCompatible"                       content="no"                />
  <meta name="theme-color"                             content="#b1cff4"           />
  <meta name="mssmarttagspreventparsing"               content="true"              />
  <meta name="apple-mobile-web-app-capable"            content="yes"               />
  <meta name="apple-mobile-web-app-status-bar-style"   content="translucent black" />
  <meta name="msapplication-navbutton-color"           content="translucent black" />
<!-- ╔══════════╗
     ║ audience ║
     ╚══════════╝ -->
  <meta name="target"                                  content="all"               />
  <meta name="audience"                                content="all"               />
  <meta name="coverage"                                content="Worldwide"         />
  <meta name="distribution"                            content="Global"            />
  <meta name="rating"                                  content="safe for kids"     />
<!-- ╔══════════╗
     ║ language ║
     ╚══════════╝ -->
  <meta http-equiv="Content-Language"                  content="en-US"             />
  <meta property="og:locale"                           content="en_US"             />
  <meta name="language"                                content="English"           />
  <meta name="og:type"                                 content="article"           />
<!-- ╔═══════════════════════════════╗
     ║ site-name and author contact. ║
     ╚═══════════════════════════════╝ -->
  <meta property="og:site_name"                        content="iCompile"          />
  <meta name="article:author"                          content="Elad Karako"       />
  <meta name="author"                                  content="Elad Karako"       />
  <meta name="owner"                                   content="Elad Karako"       />
  <meta name="contactName"                             content="Elad Karako"       />
  <meta name="dcterms.creator"                         content="Elad Karako"       />
  <link rel="me"                                       href="https://github.com/eladkarako/"  type="text/html"  />
  <link rel="author"                                   href="https://github.com/eladkarako/"                    />
  <link rel="profile"                                  href="https://gmpg.org/xfn/11"                           />
  <meta name="dcterms.type"                            content="Text"              />
  <meta name="dcterms.format"                          content="text/html"         />  
<!-- ╔═════════════════════════════════════╗
     ║ specific page information - title . ║
     ╚═════════════════════════════════════╝ -->
  <title>Anti- Anti-debugging Techniques in Win32/Napolar solarbot </title>
  <meta itemprop="name"                                content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="dcterms.title"                           content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta property="og:title"                            content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="twitter:title"                           content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="twitter:text:title"                      content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="application-name"                        content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="subject"                                 content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="apple-mobile-web-app-title"              content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="msapplication-tooltip"                   content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
<!-- ╔══════════════════════════════════════════════════════════════╗
     ║ specific page information - description (title is fine too). ║
     ╚══════════════════════════════════════════════════════════════╝ -->
  <meta name="description"                             content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta itemprop="description"                         content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="dcterms.description"                     content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta name="twitter:description"                     content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
  <meta property="og:description"                      content="Anti- Anti-debugging Techniques in Win32/Napolar solarbot "       />
<!-- ╔═══════════╗
     ║ keywords. ║
     ╚═══════════╝ -->
  <meta property="keywords"                            content="ability,acaed,algorithm,alignnone,allocate,altering,analyze,analyzed,analyzing,anti,apis,area,assembly,attempt,avast,beginning,behavior,binaries,binary,blank,blog,border,breakpoint,browser,byte,call,calling,capture,capturing,cellpadding,cellspacing,checks,child,clever,code,command,commands,computer,confirm,content,control,cool,copies,core,covered,create,creates,crime,cryp,cryptor,cyber,dcbf,debug,debugged,debugger,debugging,decrypted,decryption,decrypts,denial,desired,directly,disabling,download,dropper,dump,dynamic,encryption,engine,enter,entry,entrypoint,events,exception,executable,execute,executed,execution,exit,extract,figure,files,fills,find,form,function,functions,handled,handles,handling,harder,hashes,header,hide,high,hooking,host,identifier,image,import,imports,independent,infected,information,inject,inserting,instruction,instructs,iterate,kill,language,lets,level,library,local,loop,make,malware,match,memory,microsoft,names,napolar,network,notice,ntdll,number,offset,opcode,operating,original,overwrites,packer,parameter,parameters,parse,perform,plugin,position,post,presence,proceeds,process,processes,product,products,proper,protection,protocol,proxying,pseudo,pseudocode,push,query,received,receives,redirect,registered,replaced,report,represents,resolved,responds,rest,retrieve,returned,returns,running,runtime,samples,saved,scene,scheme,screenshot,searches,seconds,selected,server,service,shines,shows,simple,single,sirefef,size,sleep,small,socks,software,solarbot,sources,specific,standard,started,steal,stealing,stops,storage,stored,strong,structure,successful,supports,system,table,takes,target,tbody,technique,techniques,terminates,test,thread,title,traffic,trick,tricks,trojan,trusteer,type,types,update,user,username,valid,valign,variations,variety,version,walletsteal,wiki,wikipedia,windows,work,xdeadbeef,eladkarako,eladkarakomod,icompile,Elad Karako,Karako Elad,אלעד קרקו,קרקו אלעד,קרקו"    />
  <meta property="article:tag"                         content="ability,acaed,algorithm,alignnone,allocate,altering,analyze,analyzed,analyzing,anti,apis,area,assembly,attempt,avast,beginning,behavior,binaries,binary,blank,blog,border,breakpoint,browser,byte,call,calling,capture,capturing,cellpadding,cellspacing,checks,child,clever,code,command,commands,computer,confirm,content,control,cool,copies,core,covered,create,creates,crime,cryp,cryptor,cyber,dcbf,debug,debugged,debugger,debugging,decrypted,decryption,decrypts,denial,desired,directly,disabling,download,dropper,dump,dynamic,encryption,engine,enter,entry,entrypoint,events,exception,executable,execute,executed,execution,exit,extract,figure,files,fills,find,form,function,functions,handled,handles,handling,harder,hashes,header,hide,high,hooking,host,identifier,image,import,imports,independent,infected,information,inject,inserting,instruction,instructs,iterate,kill,language,lets,level,library,local,loop,make,malware,match,memory,microsoft,names,napolar,network,notice,ntdll,number,offset,opcode,operating,original,overwrites,packer,parameter,parameters,parse,perform,plugin,position,post,presence,proceeds,process,processes,product,products,proper,protection,protocol,proxying,pseudo,pseudocode,push,query,received,receives,redirect,registered,replaced,report,represents,resolved,responds,rest,retrieve,returned,returns,running,runtime,samples,saved,scene,scheme,screenshot,searches,seconds,selected,server,service,shines,shows,simple,single,sirefef,size,sleep,small,socks,software,solarbot,sources,specific,standard,started,steal,stealing,stops,storage,stored,strong,structure,successful,supports,system,table,takes,target,tbody,technique,techniques,terminates,test,thread,title,traffic,trick,tricks,trojan,trusteer,type,types,update,user,username,valid,valign,variations,variety,version,walletsteal,wiki,wikipedia,windows,work,xdeadbeef,eladkarako,eladkarakomod,icompile,Elad Karako,Karako Elad,אלעד קרקו,קרקו אלעד,קרקו"    />
<!-- ╔════════════════════════════════════════════════╗
     ║ relation: next/previous/first/last pages.      ║
     ║ (although not advised a single page-article).  ║
     ╚════════════════════════════════════════════════╝ -->
  <link rel="start"                                       href="https://icompile.eladkarako.com/show-hidden-devices-in-windows-device-manager"       />
  <link rel="prev"                                        href="https://icompile.eladkarako.com/new-dynamic-html5-iframe-attributes-with-backward-compatibility"    />
  <link rel="previous"                                    href="https://icompile.eladkarako.com/new-dynamic-html5-iframe-attributes-with-backward-compatibility"    />
  <link rel="next"                                        href="https://icompile.eladkarako.com/cool-javascript-compenent-handsontable-and-pikaday"        />
  <link rel="last"                                        href="https://icompile.eladkarako.com/shealth"        />
  <link rel="up"                                          href="https://icompile.eladkarako.com/" />
  <base target="_top"                                     href="https://icompile.eladkarako.com/" />
<!-- ╔══════╗
     ║ URL. ║
     ╚══════╝ -->
  <link rel="canonical"                                   href="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
  <meta property="og:url"                              content="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
  <meta name="twitter:url"                             content="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
  <meta name="identifier-URL"                          content="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
  <meta name="msapplication-starturl"                  content="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
  <meta name="dcterms.identifier"                      content="https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"         />
<!-- ╔════════════════════════════════╗
     ║ Data and Time - UTC. Creation. ║
     ╚════════════════════════════════╝ -->
  <meta name="creation_date"                           content="2014-09-25T23:06:56+00:00"     />
  <meta name="page-datetime"                           content="2014-09-25T23:06:56+00:00"     />
  <meta property="article:published_time"              content="2014-09-25T23:06:56+00:00"     />
  <meta name="dcterms.date"                            content="2014-09-25T23:06:56+00:00"     />
<!-- ╔═════════════════════════════════════╗
     ║ Data and Time - UTC. Last-Modified. ║
     ╚═════════════════════════════════════╝ -->
  <meta name="dcterms.modified"                        content="2014-09-25T23:10:21+00:00"    />
  <meta property="article:modified_time"               content="2014-09-25T23:10:21+00:00"    />
<!-- ╔═════════════════════════════════════════╗
     ║ License - FREE FOR ALL - PUBLIC-DOMAIN! ║
     ╚═════════════════════════════════════════╝ -->
  <link rel="license"                                     href="https://icompile.eladkarako.com/LICENSE" />
<!-- ╔════════════════════╗
     ║ preconnect (self)  ║
     ╚════════════════════╝ -->
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="https://icompile.eladkarako.com"                             />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="https://icompile.eladkarako.com"                             />
<!-- ╔═══════════════════════╗
     ║ preconnect (external) ║
     ╚═══════════════════════╝ -->
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="https://utteranc.es"                                         />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="https://utteranc.es"                                         />
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="www.googletagmanager.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="www.googletagmanager.com"                                    />
  <!-- not being used right now... 
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="www.google-analytics.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="www.google-analytics.com"                                    />
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="ssl.google-analytics.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="ssl.google-analytics.com"                                    />
  -->
<!-- ╔═════════════════╗
     ║ preload (self)  ║
     ╚═════════════════╝ -->
  <link rel="preload"        crossorigin="anonymous"        type="image/x-icon"                           as="image"                     href="https://icompile.eladkarako.com/favicon.ico"                 />
  <link rel="preload"        crossorigin="anonymous"        type="text/css"               charset="UTF-8" as="style"                     href="https://icompile.eladkarako.com/_resources/index.css"        />
  <link rel="preload"        crossorigin="anonymous"        type="text/javascript"        charset="UTF-8" as="script"                    href="https://icompile.eladkarako.com/_resources/index.js"         />
<!-- ╔════════════════════╗
     ║ preload (external) ║
     ╚════════════════════╝ -->
  <link rel="preload"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" as="script"                          href="https://utteranc.es/client.js"                               />
  <link rel="preload"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" as="script"                          href="https://www.googletagmanager.com/gtag/js?id=G-M28VNCZS3P"    />
<!-- ╔══════╗
     ║ load ║
     ╚══════╝ -->
  <link rel="icon"           crossorigin="anonymous"        type="image/x-icon"                                                                href="https://icompile.eladkarako.com/favicon.ico" />
  <link rel="shortcut icon"  crossorigin="anonymous"        type="image/x-icon"                                                                href="https://icompile.eladkarako.com/favicon.ico" />
<!-- ╔════════════════════════════════════════════════╗
     ║ page specific image (but favicon is fine too). ║
     ╚════════════════════════════════════════════════╝ -->
  <meta itemprop="image"                                    type="image/png"                                                                content="https://icompile.eladkarako.com/favicon.png" />
  <meta property="og:image"                                 type="image/png"                                                                content="https://icompile.eladkarako.com/favicon.png" />
  <link rel="apple-touch-icon image_src"                    type="image/png"                                                                   href="https://icompile.eladkarako.com/favicon.png" />
  <link rel="stylesheet"     crossorigin="anonymous"        type="text/css"               charset="UTF-8" media="all"                          href="https://icompile.eladkarako.com/_resources/index.css"   />
<!-- ╔══════════════════════════════════════════════════════╗
     ║ OpenSearch (as en external file). type is important. ║
     ╚══════════════════════════════════════════════════════╝ -->
  <link rel="search"                                   href="https://icompile.eladkarako.com/opensearch.xml" type="application/opensearchdescription+xml" title="Search icompile.eladkarako.com" charset="UTF-8" />
<!-- ╔═══════════════════════════════════════╗
     ║ micro-data in a schema-friendly JSON. ║
     ╚═══════════════════════════════════════╝ -->
  <script type="application/ld+json">
{"@context"        : "http://schema.org/"
,"@type"           : "WebSite"
,"name"            : "iCompile"
,"alternateName"   : "iCompile"
,"@id"             : "https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"
,"url"             : "https://icompile.eladkarako.com/anti-anti-debugging-techniques-in-win32napolar-solarbot"
,"headline"        : "Anti- Anti-debugging Techniques in Win32/Napolar solarbot "
,"description"     : "Anti- Anti-debugging Techniques in Win32/Napolar solarbot "
,"datePosted"      : "2014-09-25T23:06:56+00:00"
,"dateCreated"     : "2014-09-25T23:06:56+00:00"
,"datePublished"   : "2014-09-25T23:06:56+00:00"
,"dateModified"    : "2014-09-25T23:10:21+00:00"
,"thumbnailUrl"    : "https://icompile.eladkarako.com/favicon.png"
,"image"           : {"@type"       : "ImageObject"
                     ,"url"         : "https://icompile.eladkarako.com/favicon.png"
                     ,"width"       : 152
                     ,"height"      : 152
                     }
,"potentialAction" : {"@type"       : "SearchAction"
                     ,"target"      : "https://www.google.com/search/?q={query}%20site%3Ahttps%3A%2F%2Ficompile.eladkarako.com%2F"
                     ,"query"       : "required"
                     }
,"author"          : {"@type"       : "Person"
                     ,"name"        : "Elad Karako"
                     ,"givenName"   : "Elad"
                     ,"familyName"  : "Karako"
                     ,"jobTitle"    : "Software Engineer"
                     }
,"license"         : "https://icompile.eladkarako.com/LICENSE"
}
  </script>
<!-- ╔════════════════════╗
     ║ Analytics (no JS). ║
     ╚════════════════════╝ -->
  <noscript><iframe          crossorigin="anonymous"  type="text/html"              charset="UTF-8" loading="eager" lazyload="off"        src="https://www.googletagmanager.com/ns.html?id=G-M28VNCZS3P" referrerpolicy="unsafe-url" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation" seamless="false" height="0" width="0" style="display:none;"></iframe></noscript>
</head>
<body role="main">

<article id="post-0006146861141">
  <header>
    <h1 itemprop="headline">Anti- Anti-debugging Techniques in Win32/Napolar solarbot </h1>
    <sup>Posted at <time datetime="2014-09-25T23:10:21+00:00" itemprop="dateModified">Thu, 25 Sep 2014 23:10:21 GMT</time></sup>
  </header>
  <br/>
  <div itemprop="articleBody"><small><a href="https://blog.avast.com/2013/09/25/win3264napolar-new-trojan-shines-on-the-cyber-crime-scene/" title="https://blog.avast.com/2013/09/25/win3264napolar-new-trojan-shines-on-the-cyber-crime-scene/" target="_blank">Avast's report</a>.</small><br/>
<br/>
  <br/>
this will match the following variations<br/>
<br/>
<strong>Sources</strong><br/>
SHA256 hashes of some selected samples and how they are covered within the AVAST engine:<br/>
<table border="1" cellspacing="0" cellpadding="0"><br/>
<tbody><br/>
<tr><br/>
<td valign="top" width="109">Dropper 1</td><br/>
<td valign="top" width="241">1f11b896cc641db605d70186be468a148a<br/>
64ea233a21d353e7483239e71e1516</td><br/>
<td valign="top" width="204">Win32:Napolar-E [Cryp]</td><br/>
</tr><br/>
<tr><br/>
<td valign="top" width="109">Dropper 2</td><br/>
<td valign="top" width="241">f1a5707963a7e33a925111f09209a92b037<br/>
32fa9292697b37e528ad941076a8d</td><br/>
<td valign="top" width="204">Win32:Napolar-E [Cryp]</td><br/>
</tr><br/>
<tr><br/>
<td valign="top" width="109">Napolar Core Binary</td><br/>
<td valign="top" width="241">463d39dcbf19b5c4c9e314e5ce77bf8a51<br/>
848b8c7d64e4f0a6656b9d28941e2e</td><br/>
<td valign="top" width="204">Win32:Napolar-D [Trj]</td><br/>
</tr><br/>
<tr><br/>
<td valign="top" width="109">WalletSteal Plugin Download</td><br/>
<td valign="top" width="241">12ca161cd72873477906100f083e43dca9<br/>
36312ba44b691f5046f53b09e3b4f7</td><br/>
<td valign="top" width="204">JS:NapolarPlugin-A [Trj]</td><br/>
</tr><br/>
<tr><br/>
<td valign="top" width="109">WalletSteal Plugin x86</td><br/>
<td valign="top" width="241">bb49fa791915bf49ceb2a0563c91d2acaed<br/>
6249438f349c6e75094f3924de64d</td><br/>
<td valign="top" width="204">Win32:NapolarPlugin-B [Trj]</td><br/>
</tr><br/>
<tr><br/>
<td valign="top" width="109">WalletSteal Plugin x64</td><br/>
<td valign="top" width="241">ff92206215115c867789dbd5a95132a2bd1<br/>
53bb1e5a1ef66e539f382f2ce30dc</td><br/>
<td valign="top" width="204">Win32:NapolarPlugin-B [Trj]</td><br/>
</tr><br/>
</tbody><br/>
</table><br/>
  <br/>
<br/>
<br/>
The structure of the core executable(s):<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/napolar_scheme_final.png"><img loading="lazy" lazyload="on"  class="alignnone size-full wp-image-1808" src="https://icompile.eladkarako.com/_uploads/2014/09/napolar_scheme_final.png" alt="napolar_scheme_final" width="622" height="416" /></a><br/>
<br/>
When analyzing Win32/Napolar binaries, the first thing to notice is that there is no valid entry point in the PE header, as shown in the figure below.<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/01_original_entrypoint_to_0.png"><img loading="lazy" lazyload="on"  class="alignnone size-full wp-image-1807" src="https://icompile.eladkarako.com/_uploads/2014/09/01_original_entrypoint_to_0.png" alt="01_original_entrypoint_to_0" width="671" height="364" /></a><br/>
<br/>
The first instructions that are executed when the binary is started are saved in the <a href="https://en.wikipedia.org/wiki/Thread-local_storage">Thread Local Storage </a>(TLS) functions. There are two TLS functions registered.  The first TLS function does not do anything. The second function decrypts more code using the RC4 encryption algorithm and the key 0xDEADBEEF. The decrypted code is registered as a third TLS function before the second function returns,<br/>
<br/>
cool! right?<br/>
<br/>
code extract:<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/02_inserting_third_tls.png"><img loading="lazy" lazyload="on"  class="alignnone size-full wp-image-1806" src="https://icompile.eladkarako.com/_uploads/2014/09/02_inserting_third_tls.png" alt="02_inserting_third_tls" width="588" height="192" /></a><br/>
<br/>
The third TLS function decrypts the rest of the code before calling the main body of the malware.  The malware uses other tricks to make itself harder to analyze:<br/>
<ul><br/>
	<li>All imports are resolved at runtime using hashes instead of the import names.</li><br/>
	<li>Interactions with the operating system are mostly done by directly calling undocumented functions of the <a href="https://en.wikipedia.org/wiki/Microsoft_Windows_library_files#NTDLL.DLL">NTDLL</a> library instead of using the standard APIs.</li><br/>
	<li>All the code is position-independent.</li><br/>
</ul><br/>
To find the offset of its own code that will be decrypted, Win32/Napolar searches through its memory for the opcode <em>0x55</em>. This opcode represents "<em>push ebp</em>", the first instruction of the current function in assembly language. If this instruction is replaced by <em>0xCC</em>, the opcode for a software breakpoint, the decryption of the code will not work. This is a clever way of altering the behavior of the malware if it is being analyzed with a debugger and if a software breakpoint is put on the first instruction of the TLS.<br/>
<br/>
Win32/Napolar has more anti-debugging tricks. To make dynamic analysis harder, Win32/Napolar will create a sub process of itself and will debug this new instance. The screenshot below shows the call to <em>CreateProcess:</em><br/>
<br/>
<img loading="lazy" lazyload="on"  class="alignnone size-full wp-image-1805" src="https://icompile.eladkarako.com/_uploads/2014/09/05_create_process_debug_only.png" alt="05_create_process_debug_only" width="882" height="132" /><br/>
<br/>
The software protection technique of self-debugging has <a href="https://blog.avast.com/2013/05/29/analysis-of-a-self-debugging-sirefef-cryptor/">been seen before</a> but in the case of Win32/Napolar, the trick happens in the main body of the malware, not in the packer.<br/>
<br/>
Once the debugged process is started, Win32/Napolar will enter a loop that handles debugging events returned by the function <em>WaitForDebugEvent</em>. Pseudocode for the loop handling debugging events (high level.. to simple things up..)<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/04_pseudo_code_debug_loop.png"><img loading="lazy" lazyload="on"  class="alignnone wp-image-1804 size-full" src="https://icompile.eladkarako.com/_uploads/2014/09/04_pseudo_code_debug_loop.png" alt="" width="722" height="563" /></a><br/>
<br/>
The first event handled by this code is CREATE_PROCESS_DEBUG_EVENT. This event takes place when the debugged process is started. In this case, the main process will parse the MZ and PE header of the debugged process in order to retrieve the offset and size of the position-independent code. It will then allocate another area of memory in the debugged process in which to inject the code. This creates two copies of the same code in the same process.<br/>
<br/>
The next event is EXCEPTION_DEBUG_EVENT. In this second event, the main process overwrites the first TLS function of the binary so as to redirect execution at the beginning of the executable, using a push – ret instruction. This, once again, decrypts the main body of the malware and lets it execute within the child process. It is the code of the child process that then proceeds to inject itself into all the processes running sub-processes and hooking various functions to hide its presence on the system and capture desired information.<br/>
<br/>
Finally, the main process receives the EXIT_PROCESS_DEBUG_EVENT event; it stops debugging by calling the function <em>DebugActiveProcessStop</em> and terminates its own process using<em>NtTerminateProcess.</em><br/>
<br/>
One of the main characteristics of Win32/Napolar is its ability to steal information when a user fills a web form in a web browser. Trusteer's browser protection probably stops the malware from capturing this information. This is why the malware has specific checks for Trusteer products. It will iterate through all the running processes and specifically kill any process that has the string "<em>trusteer</em>" in it. We did not perform any test to confirm whether or not this attempt at disabling Trusteer's product is successful or not.<br/>
<h1>Network behavior</h1><br/>
When communicating with its command and control server, Win32/Napolar uses the HTTP protocol. The first query sent by the bot to the command and control server contains the following information:<br/>
<ul><br/>
	<li>Version of the bot</li><br/>
	<li>Current windows username of the infected user</li><br/>
	<li>Computer name</li><br/>
	<li>A unique bot identifier</li><br/>
	<li>Version of the operating system</li><br/>
	<li>System type, which can be 32 or 64 bit.  Indeed, this bot supports both types of architecture.</li><br/>
</ul><br/>
The server then responds with commands the bot needs to execute. These commands are encrypted using RC4, The bot unique identifier is used as the encryption key. The bot supports a variety of commands, from information stealing and SOCKS proxying, to denial of service, download, execution and update. Each command has a unique identifier stored as a single byte and the information following this byte contains the command parameters. The following figure shows a traffic dump of the communication between a host infected by Win32/Napolar and its command and control server.<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/06_napolar_POST.png"><img loading="lazy" lazyload="on"  class="alignnone size-full wp-image-1802" src="https://icompile.eladkarako.com/_uploads/2014/09/06_napolar_POST.png" alt="06_napolar_POST" width="593" height="263" /></a><br/>
<br/>
The following figure shows the decryption of this command using the proper key. The first byte of the received content is <em>0xC</em>, and this instructs the bot to sleep. The parameter is a string, "600", which represents the number of seconds that the bot needs to sleep.<br/>
<br/>
<a href="https://icompile.eladkarako.com/_uploads/2014/09/07_decrypted_cnc_nop.png"><img loading="lazy" lazyload="on"  class="alignnone wp-image-1801 size-full" src="https://icompile.eladkarako.com/_uploads/2014/09/07_decrypted_cnc_nop.png" alt="07_decrypted_cnc_nop" width="562" height="126" /></a></div>
  <br/>
  <br/>
  <br/>
  <footer>
    <center><a rel="first" title="First Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/show-hidden-devices-in-windows-device-manager">&vert;&lt;</a>&nbsp;<a rel="previous" title="Previous Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/new-dynamic-html5-iframe-attributes-with-backward-compatibility">&lt;</a>&nbsp;<a rel="index" title="Home-Page" itemprop="relatedLink" href="https://icompile.eladkarako.com/">&Hat;</a>&nbsp;<a rel="next" title="Next Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/cool-javascript-compenent-handsontable-and-pikaday">&gt;</a>&nbsp;<a rel="last" title="Last Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/shealth">&gt;&vert;</a></center>
    <br/>
    <table>
      <thead>
        <tr><td colspan="2">Next Articles</td></tr>
      </thead>
      <tbody>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/cool-javascript-compenent-handsontable-and-pikaday">Cool UI Compenents - HandsOnTable and PikaDay</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/web-design-best-practices-css3-responsive-style-fluid-layout-4">Web-Design Best Practices - CSS3 Responsive Style - Fluid Layout #4</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/eset-anti-virus-8-free-beta-trial">ESET Anti-Virus 8 Free Beta Trial</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/three-wishes-rule">Three Wishes Rule</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/easy-html-css3-table-6-columns">Easy HTML-CSS3 Table 6-Columns</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/javascript-ninja-solutions-aggregate-elements-positioning-and-size-with-an-additional-quick-recursive-tree-enumerator">JavaScript Ninja Solutions - Aggregate Element's Positioning And Size With An Additional Quick Recursive Tree Enumerator</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/industrys-top-6-most-commonly-used-vector-graphics-formats-today">Industry's Top-6 Most Commonly-Used Vector-Graphics Formats Today</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/javascript-non-linear-random-numbers">JavaScript Non-Linear Random Numbers</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/loose-cross-domain-xml-policy">Loose Cross-Domain XML Policy</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/morfix-melingo-android-application-request-response">Morfix Melingo Android Application Request/Response</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/bbc-iplayer-android-application-request-response">BBC iPlayer Android Application Request-Response</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/javascript-quick-and-dirty-pure-client-side-qr-code-rendering-playground">JavaScript Quick And Dirty - Pure Client-Side QR Code Rendering Playground</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/windows-7-test-mode-onoff">Windows 7 Test Mode ON/OFF</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/bash-rename-all-files-lower-case">bash rename all files lower-case</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/constantine-vs-hellblazer-success">Constantine vs. Hellblazer - Success! </a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/lenovo-x220-model-42914cg-direct-link-drivers-to-lenovo-website">Lenovo X220 Model 42914CG - Direct Link Drivers To Lenovo Website</a></td></tr>
      </tbody>
    </table>
  </footer>
</article>
<br/>
<hr/>
<br/>


<br/>
<script defer="defer"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" loading="eager" lazyload="off"        src="https://icompile.eladkarako.com/_resources/index.js"></script>
</body>
</html>