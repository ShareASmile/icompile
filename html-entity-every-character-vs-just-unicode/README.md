<pre>
<span style='color:#800000; font-weight:bold; '>function</span> to_HTMLENTITY<span style='color:#808030; '>(</span>s<span style='color:#808030; '>,</span> is_everychar<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>use strict</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span>
  <span style='color:#800000; font-weight:bold; '>var</span> regex <span style='color:#808030; '>=</span> <span style='color:#0f4d75; '>true</span> <span style='color:#808030; '>===</span> is_everychar <span style='color:#808030; '>?</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>.</span><span style='color:#800000; '>/</span>ug <span style='color:#808030; '>:</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\u0080</span><span style='color:#808030; '>-</span><span style='color:#0f69ff; '>\\u10FF</span><span style='color:#0000e6; '>FF</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span>ug
  <span style='color:#800000; font-weight:bold; '>return</span> s<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>replace</span><span style='color:#808030; '>(</span>regex<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>function</span><span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
    c <span style='color:#808030; '>=</span> c<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>charCodeAt</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>toString</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>16</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>toUpperCase</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    c <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>0000</span><span style='color:#800000; '>"</span> <span style='color:#808030; '>+</span> c<span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
    c <span style='color:#808030; '>=</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>&amp;#x</span><span style='color:#800000; '>"</span> <span style='color:#808030; '>+</span> c <span style='color:#808030; '>+</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>;</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span>
    <span style='color:#800000; font-weight:bold; '>return</span> c<span style='color:#800080; '>;</span>
  <span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>
</pre>
