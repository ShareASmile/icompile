<!DOCTYPE html>
<html encoding="UTF-8" charset="UTF-8" dir="ltr" lang="en-US" xml:lang="en-US" language="English" itemscope="" itemtype="http://schema.org/WebPage" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">

<head>
<!-- ╔════════════════════════════════════════════════╗
     ║ favor latest IE with Chrome-Frame if possible. ║
     ╚════════════════════════════════════════════════╝ -->
  <meta http-equiv="X-UA-Compatible"                   content="IE=edge,chrome=1"                                      />
<!-- ╔════════════════════════════════════════════════════════════╗
     ║ normalize script/style engine with explicit character-set. ║
     ╚════════════════════════════════════════════════════════════╝ -->
  <meta charset="UTF-8"                                                                                                />
  <meta http-equiv="content-type"                      content="text/html;charset=UTF-8"                               />
  <meta http-equiv="Content-Script-Type"               content="text/javascript;charset=UTF-8"                         />
  <meta http-equiv="Content-Style-Type"                content="text/css;charset=UTF-8"                                />
<!-- ╔══════════════════════════════════════════════╗
     ║ bread and butter of mobile-friendly website. ║
     ╚══════════════════════════════════════════════╝ -->
  <meta name="viewport"                                content="width=device-width,initial-scale=1.0,shrink-to-fit=no,minimal-ui"                                           />
<!-- ╔════════════════════════════╗
     ║ poor's man's HTTP-Headers. ║
     ╚════════════════════════════╝ -->
  <meta http-equiv="Feature-Policy"                    content="fullscreen *; wake-lock *; vibrate *; geolocation *;"  />
  <meta http-equiv="Cache-Control"                     content="public,max-age=1800,max-stale,stale-while-revalidate=86400,stale-if-error=259200" rem="max-age=30minutes"   />
  <meta http-equiv="X-Content-Type-Options"            content="nosniff"                                               />
  <meta http-equiv="X-DNS-Prefetch-Control"            content="on"                                                    />
<!-- needs more work... 
  <meta http-equiv="Content-Security-Policy"           content="default-src 'none'; base-uri 'self'; block-all-mixed-content; connect-src 'self' icompile.eladkarako.com eladkarako.com eladkarako.github.io www.google.com www.google-analytics.com www.googletagmanager.com www.github.com gist.github.com gist.githubusercontent.com; font-src github.githubassets.com; form-action 'none; frame-ancestors 'self'; frame-src 'self' render.githubusercontent.com gist.github.com; img-src 'self' *.imgur.com data: *.githubusercontent.com; media-src 'none'; script-src 'self' github.githubassets.com; style-src 'unsafe-inline' github.githubassets.com; worker-src 'none'"                                                                                                         />
-->  
  <meta http-equiv="X-XSS-Protection"                  content="1; mode=block"                                         />
<!-- ╔════════════════════════════════════╗
     ║ disable browser annoying features. ║
     ╚════════════════════════════════════╝ -->
  <meta name="format-detection"                        content="telephone=no,date=no,address=no,email=no,url=no"       />
  <meta http-equiv="imagetoolbar"                      content="no"                                                    />
  <meta http-equiv="cleartype"                         content="on"                                                    />
  <meta http-equiv="Page-Enter"                        content="RevealTrans(Duration=0.0,Transition=0.0)"              />
  <meta http-equiv="Page-Exit"                         content="RevealTrans(Duration=0.0,Transition=0.0)"              />
  <!-----------------------------------------------------------------------do not modify line below here, an installed skype read it AS IS (you need to make the HTML is UTF-8 (no BOM) with Windown EOL). -->
  <meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE">
  <!--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- ╔══════════════════════════════════╗
     ║ compatible with viewport for IE. ║
     ╚══════════════════════════════════╝ -->
  <meta name="HandheldFriendly"                        content="True"              />
  <meta name="MSThemeCompatible"                       content="no"                />
  <meta name="theme-color"                             content="#b1cff4"           />
  <meta name="mssmarttagspreventparsing"               content="true"              />
  <meta name="apple-mobile-web-app-capable"            content="yes"               />
  <meta name="apple-mobile-web-app-status-bar-style"   content="translucent black" />
  <meta name="msapplication-navbutton-color"           content="translucent black" />
<!-- ╔══════════╗
     ║ audience ║
     ╚══════════╝ -->
  <meta name="target"                                  content="all"               />
  <meta name="audience"                                content="all"               />
  <meta name="coverage"                                content="Worldwide"         />
  <meta name="distribution"                            content="Global"            />
  <meta name="rating"                                  content="safe for kids"     />
<!-- ╔══════════╗
     ║ language ║
     ╚══════════╝ -->
  <meta http-equiv="Content-Language"                  content="en-US"             />
  <meta property="og:locale"                           content="en_US"             />
  <meta name="language"                                content="English"           />
  <meta name="og:type"                                 content="article"           />
<!-- ╔═══════════════════════════════╗
     ║ site-name and author contact. ║
     ╚═══════════════════════════════╝ -->
  <meta property="og:site_name"                        content="iCompile"          />
  <meta name="article:author"                          content="Elad Karako"       />
  <meta name="author"                                  content="Elad Karako"       />
  <meta name="owner"                                   content="Elad Karako"       />
  <meta name="contactName"                             content="Elad Karako"       />
  <meta name="dcterms.creator"                         content="Elad Karako"       />
  <link rel="me"                                       href="https://github.com/eladkarako/"  type="text/html"  />
  <link rel="author"                                   href="https://github.com/eladkarako/"                    />
  <link rel="profile"                                  href="https://gmpg.org/xfn/11"                           />
  <meta name="dcterms.type"                            content="Text"              />
  <meta name="dcterms.format"                          content="text/html"         />  
<!-- ╔═════════════════════════════════════╗
     ║ specific page information - title . ║
     ╚═════════════════════════════════════╝ -->
  <title>Chrome Extension Snippet - Modify Response Header</title>
  <meta itemprop="name"                                content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="dcterms.title"                           content="Chrome Extension Snippet - Modify Response Header"       />
  <meta property="og:title"                            content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="twitter:title"                           content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="twitter:text:title"                      content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="application-name"                        content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="subject"                                 content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="apple-mobile-web-app-title"              content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="msapplication-tooltip"                   content="Chrome Extension Snippet - Modify Response Header"       />
<!-- ╔══════════════════════════════════════════════════════════════╗
     ║ specific page information - description (title is fine too). ║
     ╚══════════════════════════════════════════════════════════════╝ -->
  <meta name="description"                             content="Chrome Extension Snippet - Modify Response Header"       />
  <meta itemprop="description"                         content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="dcterms.description"                     content="Chrome Extension Snippet - Modify Response Header"       />
  <meta name="twitter:description"                     content="Chrome Extension Snippet - Modify Response Header"       />
  <meta property="og:description"                      content="Chrome Extension Snippet - Modify Response Header"       />
<!-- ╔═══════════╗
     ║ keywords. ║
     ╚═══════════╝ -->
  <meta property="keywords"                            content="accepted,additions,addlistener,array,beacon,blank,block,blocking,bold,boost,boostaler,browser,browsers,cache,called,change,chrome,click,code,color,console,control,cookies,copy,cors,days,debug,debugging,delete,developer,directive,doublecomma,edit,edited,entries,error,existing,extension,extensions,extract,fake,false,file,filters,firstcomma,font,fool,forbidden,foreach,frame,function,generated,github,google,handler,header,headers,helpful,helps,html,image,imageset,includes,index,info,inspect,item,javascript,limit,limited,listener,listening,local,lower,makes,manifest,media,modified,modify,mozilla,nice,notify,object,objects,option,original,override,page,pages,permission,permissions,persistent,ping,pipelines,plain,prepare,push,readonly,reasons,regex,regularly,remove,replace,report,request,requests,requires,resources,response,return,revalidate,script,scripts,server,shamelessly,shows,simply,snippet,spec,specific,stale,stalewhile,store,stylesheet,switch,synchronous,target,test,tolowercase,type,types,updated,urls,version,versions,webrequest,websocket,webstore,weight,work,world,write,xslt,eladkarako,eladkarakomod,icompile,Elad Karako,Karako Elad,אלעד קרקו,קרקו אלעד,קרקו"    />
  <meta property="article:tag"                         content="accepted,additions,addlistener,array,beacon,blank,block,blocking,bold,boost,boostaler,browser,browsers,cache,called,change,chrome,click,code,color,console,control,cookies,copy,cors,days,debug,debugging,delete,developer,directive,doublecomma,edit,edited,entries,error,existing,extension,extensions,extract,fake,false,file,filters,firstcomma,font,fool,forbidden,foreach,frame,function,generated,github,google,handler,header,headers,helpful,helps,html,image,imageset,includes,index,info,inspect,item,javascript,limit,limited,listener,listening,local,lower,makes,manifest,media,modified,modify,mozilla,nice,notify,object,objects,option,original,override,page,pages,permission,permissions,persistent,ping,pipelines,plain,prepare,push,readonly,reasons,regex,regularly,remove,replace,report,request,requests,requires,resources,response,return,revalidate,script,scripts,server,shamelessly,shows,simply,snippet,spec,specific,stale,stalewhile,store,stylesheet,switch,synchronous,target,test,tolowercase,type,types,updated,urls,version,versions,webrequest,websocket,webstore,weight,work,world,write,xslt,eladkarako,eladkarakomod,icompile,Elad Karako,Karako Elad,אלעד קרקו,קרקו אלעד,קרקו"    />
<!-- ╔════════════════════════════════════════════════╗
     ║ relation: next/previous/first/last pages.      ║
     ║ (although not advised a single page-article).  ║
     ╚════════════════════════════════════════════════╝ -->
  <link rel="start"                                       href="https://icompile.eladkarako.com/show-hidden-devices-in-windows-device-manager"       />
  <link rel="prev"                                        href="https://icompile.eladkarako.com/java-snippet-port-finder"    />
  <link rel="previous"                                    href="https://icompile.eladkarako.com/java-snippet-port-finder"    />
  <link rel="next"                                        href="https://icompile.eladkarako.com/ffmpeg-pre-fill-file-duration-into-ffmpegs-mp3-concatenation-file-list-using-ffprobe"        />
  <link rel="last"                                        href="https://icompile.eladkarako.com/shealth"        />
  <link rel="up"                                          href="https://icompile.eladkarako.com/" />
  <base target="_top"                                     href="https://icompile.eladkarako.com/" />
<!-- ╔══════╗
     ║ URL. ║
     ╚══════╝ -->
  <link rel="canonical"                                   href="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
  <meta property="og:url"                              content="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
  <meta name="twitter:url"                             content="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
  <meta name="identifier-URL"                          content="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
  <meta name="msapplication-starturl"                  content="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
  <meta name="dcterms.identifier"                      content="https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"         />
<!-- ╔════════════════════════════════╗
     ║ Data and Time - UTC. Creation. ║
     ╚════════════════════════════════╝ -->
  <meta name="creation_date"                           content="2017-01-19T22:13:37+00:00"     />
  <meta name="page-datetime"                           content="2017-01-19T22:13:37+00:00"     />
  <meta property="article:published_time"              content="2017-01-19T22:13:37+00:00"     />
  <meta name="dcterms.date"                            content="2017-01-19T22:13:37+00:00"     />
<!-- ╔═════════════════════════════════════╗
     ║ Data and Time - UTC. Last-Modified. ║
     ╚═════════════════════════════════════╝ -->
  <meta name="dcterms.modified"                        content="2017-02-01T01:42:31+00:00"    />
  <meta property="article:modified_time"               content="2017-02-01T01:42:31+00:00"    />
<!-- ╔═════════════════════════════════════════╗
     ║ License - FREE FOR ALL - PUBLIC-DOMAIN! ║
     ╚═════════════════════════════════════════╝ -->
  <link rel="license"                                     href="https://icompile.eladkarako.com/LICENSE" />
<!-- ╔════════════════════╗
     ║ preconnect (self)  ║
     ╚════════════════════╝ -->
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="https://icompile.eladkarako.com"                             />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="https://icompile.eladkarako.com"                             />
<!-- ╔═══════════════════════╗
     ║ preconnect (external) ║
     ╚═══════════════════════╝ -->
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="https://utteranc.es"                                         />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="https://utteranc.es"                                         />
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="www.googletagmanager.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="www.googletagmanager.com"                                    />
  <!-- not being used right now... 
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="www.google-analytics.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="www.google-analytics.com"                                    />
  <link rel="dns-prefetch"   crossorigin="anonymous"                                                                                     href="ssl.google-analytics.com"                                    />
  <link rel="preconnect"     crossorigin="anonymous"                                                                                     href="ssl.google-analytics.com"                                    />
  -->
<!-- ╔═════════════════╗
     ║ preload (self)  ║
     ╚═════════════════╝ -->
  <link rel="preload"        crossorigin="anonymous"        type="image/x-icon"                           as="image"                     href="https://icompile.eladkarako.com/favicon.ico"                 />
  <link rel="preload"        crossorigin="anonymous"        type="text/css"               charset="UTF-8" as="style"                     href="https://icompile.eladkarako.com/_resources/index.css"        />
  <link rel="preload"        crossorigin="anonymous"        type="text/javascript"        charset="UTF-8" as="script"                    href="https://icompile.eladkarako.com/_resources/index.js"         />
<!-- ╔════════════════════╗
     ║ preload (external) ║
     ╚════════════════════╝ -->
  <link rel="preload"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" as="script"                          href="https://utteranc.es/client.js"                               />
  <link rel="preload"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" as="script"                          href="https://www.googletagmanager.com/gtag/js?id=G-M28VNCZS3P"    />
<!-- ╔══════╗
     ║ load ║
     ╚══════╝ -->
  <link rel="icon"           crossorigin="anonymous"        type="image/x-icon"                                                                href="https://icompile.eladkarako.com/favicon.ico" />
  <link rel="shortcut icon"  crossorigin="anonymous"        type="image/x-icon"                                                                href="https://icompile.eladkarako.com/favicon.ico" />
<!-- ╔════════════════════════════════════════════════╗
     ║ page specific image (but favicon is fine too). ║
     ╚════════════════════════════════════════════════╝ -->
  <meta itemprop="image"                                    type="image/png"                                                                content="https://icompile.eladkarako.com/favicon.png" />
  <meta property="og:image"                                 type="image/png"                                                                content="https://icompile.eladkarako.com/favicon.png" />
  <link rel="apple-touch-icon image_src"                    type="image/png"                                                                   href="https://icompile.eladkarako.com/favicon.png" />
  <link rel="stylesheet"     crossorigin="anonymous"        type="text/css"               charset="UTF-8" media="all"                          href="https://icompile.eladkarako.com/_resources/index.css"   />
<!-- ╔══════════════════════════════════════════════════════╗
     ║ OpenSearch (as en external file). type is important. ║
     ╚══════════════════════════════════════════════════════╝ -->
  <link rel="search"                                   href="https://icompile.eladkarako.com/opensearch.xml" type="application/opensearchdescription+xml" title="Search icompile.eladkarako.com" charset="UTF-8" />
<!-- ╔═══════════════════════════════════════╗
     ║ micro-data in a schema-friendly JSON. ║
     ╚═══════════════════════════════════════╝ -->
  <script type="application/ld+json">
{"@context"        : "http://schema.org/"
,"@type"           : "WebSite"
,"name"            : "iCompile"
,"alternateName"   : "iCompile"
,"@id"             : "https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"
,"url"             : "https://icompile.eladkarako.com/chrome-extension-snippet-modify-response-header"
,"headline"        : "Chrome Extension Snippet - Modify Response Header"
,"description"     : "Chrome Extension Snippet - Modify Response Header"
,"datePosted"      : "2017-01-19T22:13:37+00:00"
,"dateCreated"     : "2017-01-19T22:13:37+00:00"
,"datePublished"   : "2017-01-19T22:13:37+00:00"
,"dateModified"    : "2017-02-01T01:42:31+00:00"
,"thumbnailUrl"    : "https://icompile.eladkarako.com/favicon.png"
,"image"           : {"@type"       : "ImageObject"
                     ,"url"         : "https://icompile.eladkarako.com/favicon.png"
                     ,"width"       : 152
                     ,"height"      : 152
                     }
,"potentialAction" : {"@type"       : "SearchAction"
                     ,"target"      : "https://www.google.com/search/?q={query}%20site%3Ahttps%3A%2F%2Ficompile.eladkarako.com%2F"
                     ,"query"       : "required"
                     }
,"author"          : {"@type"       : "Person"
                     ,"name"        : "Elad Karako"
                     ,"givenName"   : "Elad"
                     ,"familyName"  : "Karako"
                     ,"jobTitle"    : "Software Engineer"
                     }
,"license"         : "https://icompile.eladkarako.com/LICENSE"
}
  </script>
<!-- ╔════════════════════╗
     ║ Analytics (no JS). ║
     ╚════════════════════╝ -->
  <noscript><iframe          crossorigin="anonymous"  type="text/html"              charset="UTF-8" loading="eager" lazyload="off"        src="https://www.googletagmanager.com/ns.html?id=G-M28VNCZS3P" referrerpolicy="unsafe-url" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation" seamless="false" height="0" width="0" style="display:none;"></iframe></noscript>
</head>
<body role="main">

<article id="post-0007104684841">
  <header>
    <h1 itemprop="headline">Chrome Extension Snippet - Modify Response Header</h1>
    <sup>Posted at <time datetime="2017-02-01T01:42:31+00:00" itemprop="dateModified">Wed, 01 Feb 2017 01:42:31 GMT</time></sup>
  </header>
  <br/>
  <div itemprop="articleBody">If you would like to 'fake give yourself CORS' for every request, modify cookies to remove the 'http' only directive so you could always edit cookies using javascript, or perhaps just add an <code>X-Hello: World</code> header to every response you get from anywhere, to fool your browser to think it is the real thing, got from a foo-server,<br/>
- here is what you need to do:<br/>
<!--more--><br/>
prepare manifest with the following permissions:<br/>
<pre>
, "permissions"             : ["*://*/*"
                              ,"webRequest"
                              ,"webRequestBlocking"
                              ]
</pre><br/>
allow your background script to run in the background:<br/>
<pre>
, "background"              : { "scripts":    [ 
                                                "resources/background_response_manipulation.js"
                                              ]
                              , "persistent": true 
                              }

</pre><br/>
<br/>
in your background javascript file, add a listener to <code>chrome.webRequest.onHeadersReceived</code><br/>
<pre><br/>
function headers_handler(response){<br/>
  .....<br/>
  //shamelessly override/modify response.responseHeaders array (it's ok since it is just a local copy)<br/>
  .....<br/>
  return {"responseHeaders": response.responseHeaders};<br/>
}<br/>
<br/>
filters   = {urls:  ["<all_urls>"]<br/>
            ,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object"]<br/>
            };<br/>
info_spec = ["responseHeaders", "blocking"];<br/>
<br/>
chrome.webRequest.onHeadersReceived.addListener(headers_handler, filters, info_spec);<br/>
</pre><br/>
<br/>
- if only want to work on HTML pages- limit the filters to just ["main_frame", "sub_frame"]  .<br/>
- you may add <code>"ping","other"</code> to modify other resources too..  .<br/>
- you may keep info_spec set to both <code>["responseHeaders", "blocking"]</code> even if you don't want to block anything, some resources say it helps for some reasons, since it makes some of the pipelines synchronous. but it will also requires the 'webRequestBlocking' permission.<br/>
<br/>
do you want to debug the final-version of the response-headers after all the modification? simply add a listener to <code>chrome.webRequest.onResponseStarted</code>, go to <code>chrome://extensions/</code>, click the inspect the generated-background page, switch to console to see anything you write into the background-script's <code>console.log</code>.<br/>
<br/>
- <code>response.responseHeaders</code> is an array of plain objects <code>{name: '.....', value: '.....'}</code>, you can modify, delete or add new entries onto the <code>response.responseHeaders</code> itself, since while in the function, it is just a local-copy, so it does not change anything, when done- return an object having the key <code>responseHeaders</code> with your the modify version.<br/>
<br/>
- here is a (very limited) link to Chrome's documentations: <a href="https://developer.chrome.com/extensions/webRequest#type-OnHeadersReceivedOptions" target="_blank">https://developer.chrome.com/extensions/webRequest#type-OnHeadersReceivedOptions</a><br/>
<br/>
- here is a full example for a background script that modify the 'cache-control' (notify that header's name is always lower-case) to have an additions of the new stale-while.. directive.<br/>
<br/>
it is part of my <code>Boostaler</code> <sup><em>(= boost+stale+er)</em></sup> Chrome extension <sup>(<a href="https://github.com/eladkarako/Chrome-Extension-Boostaler" target="_blank">GitHub</a>, <a href="https://chrome.google.com/webstore/detail/boostaler/dalkfakmooljfejnddeaibdkgbbogpea" target="_blank">Chrome Store</a>)</sup>.<br/>
<br/>
<pre><br/>
<span style='color:#696969; '>/* ╔════════════════════════════════════════╗</span><br/>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;║ background_response_manipulation       ║</span><br/>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;╟────────────────────────────────────────╢</span><br/>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;║                                        ║</span><br/>
<span style='color:#696969; '>&#xa0;&#xa0;&#xa0;╚════════════════════════════════════════╝</span><br/>
<span style='color:#696969; '>░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ */</span><br/>
<br/>
regex_stalewhile   <span style='color:#808030; '>=</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>stale-while-revalidate</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>i</span><span style='color:#800080; '>;</span><br/>
regex_staleiferror <span style='color:#808030; '>=</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>stale-if-error</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>i</span><span style='color:#800080; '>;</span><br/>
regex_firstcomma   <span style='color:#808030; '>=</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\\,</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span><br/>
regex_doublecomma   <span style='color:#808030; '>=</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>,,</span><span style='color:#808030; '>+</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span><br/>
<br/>
<span style='color:#800000; font-weight:bold; '>function</span> headers_handler<span style='color:#808030; '>(</span>response<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span><br/>
  <span style='color:#696969; '>// extract original</span><br/>
  <span style='color:#800000; font-weight:bold; '>var</span> is_edited <span style='color:#808030; '>=</span> <span style='color:#0f4d75; '>false</span><span style='color:#800080; '>;</span><br/>
<br/>
  response<span style='color:#808030; '>.</span>responseHeaders<span style='color:#808030; '>.</span>forEach<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>function</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>,</span> <span style='color:#797997; '>index</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span><br/>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>cache-control</span><span style='color:#800000; '>"</span> <span style='color:#808030; '>!==</span> <span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>name<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>toLowerCase</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>   <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span><br/>
<br/>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#0f4d75; '>false</span> <span style='color:#808030; '>===</span> regex_stalewhile<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>test</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>   <span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value <span style='color:#808030; '>+=</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>,stale-while-revalidate=86400</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>//edit existing</span><br/>
    <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#0f4d75; '>false</span> <span style='color:#808030; '>===</span> regex_staleiferror<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>test</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value <span style='color:#808030; '>+=</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>,stale-if-error=259200</span><span style='color:#800000; '>"</span><span style='color:#800080; '>;</span><br/>
<br/>
    <span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>item</span><span style='color:#808030; '>.</span>value<span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>replace</span><span style='color:#808030; '>(</span>regex_firstcomma<span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>replace</span><span style='color:#808030; '>(</span>regex_doublecomma<span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>//fix</span><br/>
<br/>
    is_edited <span style='color:#808030; '>=</span> <span style='color:#0f4d75; '>true</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>//if false, there was no cache-control header</span><br/>
  <span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span><br/>
  <br/>
  <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#0f4d75; '>false</span> <span style='color:#808030; '>===</span> is_edited<span style='color:#808030; '>)</span> response<span style='color:#808030; '>.</span>responseHeaders<span style='color:#808030; '>.</span>push<span style='color:#808030; '>(</span><span style='color:#800080; '>{</span>name<span style='color:#800080; '>:</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>cache-control</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> value<span style='color:#800080; '>:</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>stale-while-revalidate=86400,stale-if-error=259200</span><span style='color:#800000; '>"</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span><br/>
<br/>
  <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800080; '>{</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>responseHeaders</span><span style='color:#800000; '>"</span><span style='color:#800080; '>:</span> response<span style='color:#808030; '>.</span>responseHeaders<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span><br/>
<span style='color:#800080; '>}</span><br/>
<br/>
filters   <span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span>urls<span style='color:#800080; '>:</span>  <span style='color:#808030; '>[</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>&lt;all_urls></span><span style='color:#800000; '>"</span><span style='color:#808030; '>]</span><br/>
            <span style='color:#808030; '>,</span>types<span style='color:#800080; '>:</span> <span style='color:#808030; '>[</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>main_frame</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>sub_frame</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>stylesheet</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>script</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>image</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>font</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>object</span><span style='color:#800000; '>"</span><span style='color:#808030; '>]</span><br/>
            <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span><br/>
info_spec <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>responseHeaders</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>blocking</span><span style='color:#800000; '>"</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span><br/>
<br/>
chrome<span style='color:#808030; '>.</span>webRequest<span style='color:#808030; '>.</span>onHeadersReceived<span style='color:#808030; '>.</span>addListener<span style='color:#808030; '>(</span>headers_handler<span style='color:#808030; '>,</span> filters<span style='color:#808030; '>,</span> info_spec<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span><br/>
<br/>
<span style='color:#696969; '>/*</span><br/>
<span style='color:#696969; '>//for debugging - will shows (readonly) the final version of the response-headers, after modified by ALL the extensions.</span><br/>
<span style='color:#696969; '>chrome.webRequest.onResponseStarted.addListener(function(response){ console.log(response); }, filters, ["responseHeaders"]);</span><br/>
<span style='color:#696969; '>*/</span><br/>
</pre><br/>
<br/>
here is a modification that will allow more/less "listening for requests"...<br/>
the third option is not accepted by Chrome, just Mozilla browsers.. but it's nice to try :)<br/>
<br/>
<pre>
          //,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object"]
            ,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object", "xmlhttprequest", "ping", "other"]   /* Chrome max value:   https://developer.chrome.com/extensions/webRequest */
          //,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object", "xmlhttprequest", "ping", "other", "xbl", "xslt", "beacon", "xml_dtd", "media", "websocket", "csp_report", "imageset", "web_manifest"] /* Mozilla max value:  https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/webRequest/ResourceType */
</pre><br/>
<br/>
since <code>XMLHTTPRequest</code> objects are usually called for specific request,<br/>
part from those whom are called regularly.. there is not much of a point in including it..<br/>
<br/>
ping might have positive effect (although ping requests are forbidden now days in new-chrome versions..),<br/>
other can be anything really, maybe it includes media, beacon which is helpful to be stale'able.. :)<br/>
<br/>
so really what we're having is:<br/>
<pre><br/>
filters   = {urls:  ["<all_urls>"]<br/>
          //,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object"]                                         /*original set*/<br/>
            ,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object",                   "ping", "other"]      /*all but not xhr, always keep the xhr most-updated...*/<br/>
          //,types: ["main_frame", "sub_frame", "stylesheet", "script", "image", "font", "object", "xmlhttprequest", "ping", "other"]      /* Chrome max value:   https://developer.chrome.com/extensions/webRequest -- other might be ["xbl", "xslt", "beacon", "xml_dtd", "media", "websocket", "csp_report", "imageset", "web_manifest"] from: Mozilla max value:  https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/webRequest/ResourceType */<br/>
            };<br/>
</pre><br/>
<br/>
fun!</div>
  <br/>
  <br/>
  <br/>
  <footer>
    <center><a rel="first" title="First Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/show-hidden-devices-in-windows-device-manager">&vert;&lt;</a>&nbsp;<a rel="previous" title="Previous Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/java-snippet-port-finder">&lt;</a>&nbsp;<a rel="index" title="Home-Page" itemprop="relatedLink" href="https://icompile.eladkarako.com/">&Hat;</a>&nbsp;<a rel="next" title="Next Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/ffmpeg-pre-fill-file-duration-into-ffmpegs-mp3-concatenation-file-list-using-ffprobe">&gt;</a>&nbsp;<a rel="last" title="Last Article" itemprop="relatedLink" href="https://icompile.eladkarako.com/shealth">&gt;&vert;</a></center>
    <br/>
    <table>
      <thead>
        <tr><td colspan="2">Next Articles</td></tr>
      </thead>
      <tbody>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/ffmpeg-pre-fill-file-duration-into-ffmpegs-mp3-concatenation-file-list-using-ffprobe">Using FFPROBE</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/ffmpeg-fixes-your-everything">FFMPEG Fixes Your... Everything!</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/solved-google-chrome-hides-the-url-of-error-pages">Solved: Google Chrome Hides The URL Of Error Pages</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/bitcoin-emoji">Ƀ - BitCoin Emoji</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/html-entity-every-character-vs-just-unicode">HTML ENTITY - Every Character VS. Just Unicode</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/html-entity-infinite-convertion-bookmarklet-toolkit">HTML Entity - Infinite Convertion Bookmarklet Toolkit</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/keyframe-animation-example">CSS3 Ninja - Pure CSS-KeyFrame Animation Example</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/ebay-bad-sellers">eBay Bad Sellers</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/htaccess-cors">.htaccess CORS</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/delete-a-lot-of-wordpress-tags">Delete A Lot Of WordPress Tags</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/harry-dresden-wizard">HARRY DRESDEN - WIZARD</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/complete-fill-textarea-page">HTML Snippet - 100% Fill Textarea-Page</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/solved-vmware-thinapp-import-error">Solved: VMware ThinAPP Import Error</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/html-entity-minimal-common">HTML-Entity - Minimal Common</a></td></tr>
        <tr><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/100-client-side-file-to-base64-converter">100% Client-Side File To Base64 Converter</a></td><td><a itemprop="relatedLink" href="https://icompile.eladkarako.com/aria2c-sample-chromium-command-line-switch-updater">aria2c Sample - Chromium Command-Line Switch Updater</a></td></tr>
      </tbody>
    </table>
  </footer>
</article>
<br/>
<hr/>
<br/>


<br/>
<script defer="defer"        crossorigin="anonymous"  type="text/javascript"        charset="UTF-8" loading="eager" lazyload="off"        src="https://icompile.eladkarako.com/_resources/index.js"></script>
</body>
</html>